<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Galactic Empire: Offline Infinity</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: #000;
            color: #e0e0e0;
            overflow-x: hidden;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            touch-action: manipulation;
        }

        /* Cinematic Background */
        .space-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: url('hero-cinematic.png') center/cover; z-index: -2;
        }
        .space-bg::before {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(ellipse at center, rgba(0, 20, 40, 0.4) 0%, rgba(0, 0, 0, 0.9) 100%);
            z-index: -1;
        }

        /* Animated Stars */
        .stars {
            position: fixed; inset: 0; z-index: -1; pointer-events: none;
        }
        .star {
            position: absolute; width: 2px; height: 2px;
            background: white; border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed; inset: 0; background: #000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999; transition: opacity 1s ease;
        }
        .loading-screen.hidden { opacity: 0; pointer-events: none; }
        .loading-title {
            font-family: 'Orbitron', monospace; font-size: clamp(1.5rem, 8vw, 3rem);
            font-weight: 900;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 30px; animation: loadingPulse 2s ease-in-out infinite;
        }
        @keyframes loadingPulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
        .loading-bar {
            width: 80%; max-width: 300px; height: 4px;
            background: rgba(255, 255, 255, 0.2); border-radius: 2px; overflow: hidden;
        }
        .loading-progress {
            height: 100%; background: linear-gradient(45deg, #00ffff, #ff00ff);
            border-radius: 2px; animation: loadingProgress 3s ease-in-out infinite;
        }
        @keyframes loadingProgress { 0% { width: 0%; } 50% { width: 70%; } 100% { width: 100%; } }

        /* Auth Screen */
        .auth-screen {
            position: fixed; inset: 0; background: rgba(0, 0, 0, 0.95);
            display: flex; align-items: center; justify-content: center; z-index: 10000;
            backdrop-filter: blur(10px);
        }
        .auth-container {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px;
            padding: 40px; width: 90%; max-width: 400px; text-align: center;
        }
        .auth-title {
            font-family: 'Orbitron', monospace; font-size: 2rem; font-weight: 900;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }
        .auth-input {
            width: 100%; padding: 15px; margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 10px;
            color: white; font-size: 1rem;
        }
        .auth-input::placeholder { color: rgba(255, 255, 255, 0.6); }
        .auth-button {
            width: 100%; padding: 15px;
            background: linear-gradient(45deg, #00ffff, #0066cc);
            border: none; border-radius: 10px; color: white; font-weight: bold;
            cursor: pointer; transition: all 0.3s ease; margin-bottom: 15px;
        }
        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.4);
        }
        .auth-switch { color: #00ffff; cursor: pointer; text-decoration: underline; }

        /* Main Container */
        .container {
            max-width: 1400px; margin: 0 auto; padding: 20px;
            position: relative; z-index: 1;
        }

        /* Header */
        .header {
            display: grid; grid-template-columns: 1fr auto 1fr;
            align-items: center; margin-bottom: 30px; gap: 20px;
        }
        .game-title {
            font-family: 'Orbitron', monospace;
            font-size: clamp(2rem, 5vw, 3.5rem); font-weight: 900;
            background: linear-gradient(45deg, #00ffff, #ff00ff, #ffff00);
            background-size: 200% 200%; -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 3s ease-in-out infinite;
            text-align: center;
        }
        @keyframes gradientShift { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }

        .player-info {
            display: flex; align-items: center; gap: 15px;
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px;
            padding: 15px;
        }
        .player-avatar {
            width: 50px; height: 50px; border-radius: 50%;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: #000; font-weight: bold;
        }
        .player-details { flex: 1; }
        .player-name { font-weight: bold; margin-bottom: 5px; }
        .player-level { font-size: 0.9rem; opacity: 0.8; }
        .logout-btn {
            background: rgba(255, 0, 0, 0.3); border: 1px solid rgba(255, 0, 0, 0.5);
            color: white; padding: 8px 15px; border-radius: 8px; cursor: pointer;
            transition: all 0.3s ease;
        }
        .logout-btn:hover { background: rgba(255, 0, 0, 0.5); }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex; gap: 10px; margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 15px;
            padding: 10px; overflow-x: auto;
        }
        .nav-tab {
            padding: 12px 20px; background: transparent; border: none;
            color: rgba(255, 255, 255, 0.7); cursor: pointer; border-radius: 10px;
            transition: all 0.3s ease; white-space: nowrap;
            display: flex; align-items: center; gap: 8px; min-width: fit-content;
        }
        .nav-tab.active {
            background: rgba(0, 255, 255, 0.2); color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }
        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.1); color: white;
        }

        /* Game Content Areas */
        .game-content { display: none; }
        .game-content.active { display: block; }

        /* Empire Tab */
        .empire-stats {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px; margin-bottom: 30px;
        }
        .stat-item {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px;
            padding: 20px; text-align: center; transition: all 0.3s ease;
            position: relative; overflow: hidden;
        }
        .stat-item::before {
            content: ''; position: absolute; top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s;
        }
        .stat-item:hover::before { left: 100%; }
        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.3);
        }
        .stat-icon { font-size: 1.8rem; margin-bottom: 10px; display: block; }
        .stat-value {
            font-family: 'Orbitron', monospace; font-size: 1.3rem; font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label { font-size: 0.9rem; opacity: 0.8; }

        /* Resources Panel */
        .resources-panel {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px; margin-bottom: 30px;
        }
        .resource-card {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px;
            padding: 20px; text-align: center; transition: all 0.3s ease;
            position: relative; overflow: hidden;
        }
        .resource-card::before {
            content: ''; position: absolute; top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        .resource-card:hover::before { left: 100%; }
        .resource-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.3);
        }
        .resource-icon {
            width: 60px; height: 60px; margin: 0 auto 15px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: bold; color: #000;
        }
        .energy-icon { background: linear-gradient(45deg, #9c27b0, #e91e63); }
        .mineral-icon { background: linear-gradient(45deg, #607d8b, #9e9e9e); }
        .crystal-icon { background: linear-gradient(45deg, #ff9800, #ffc107); }
        .plasma-icon { background: linear-gradient(45deg, #2196f3, #00bcd4); }
        .darkmatter-icon { background: linear-gradient(45deg, #000, #673ab7); }
        .quantum-icon { background: linear-gradient(45deg, #4caf50, #8bc34a); }
        .infinity-icon { background: linear-gradient(45deg, #f44336, #ff5722); }
        
        .resource-amount {
            font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;
            font-family: 'Orbitron', monospace;
        }
        .resource-rate { font-size: 0.9rem; opacity: 0.8; }

        /* Main Clicker */
        .main-clicker {
            width: 250px; height: 250px; border-radius: 50%; margin: 0 auto 30px;
            background: radial-gradient(circle at 30% 30%, #00ffff, #0066cc, #003366);
            border: 3px solid #00ffff;
            box-shadow: 
                0 0 30px rgba(0, 255, 255, 0.5),
                inset 0 0 30px rgba(255, 255, 255, 0.1),
                0 0 60px rgba(0, 255, 255, 0.3);
            cursor: pointer; transition: all 0.1s ease;
            position: relative; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
        }
        .main-clicker:active { transform: scale(0.95); }
        .clicker-core {
            width: 180px; height: 180px; border-radius: 50%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            animation: corePulse 3s ease-in-out infinite;
            display: flex; align-items: center; justify-content: center; flex-direction: column;
        }
        @keyframes corePulse {
            0%, 100% { opacity: 0.4; transform: scale(0.9); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }
        .clicker-text {
            font-family: 'Orbitron', monospace; font-size: 1.2rem; font-weight: bold;
            color: #fff; text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            text-align: center; margin-bottom: 10px;
        }
        .clicker-power { font-size: 1rem; opacity: 0.8; color: #ffff00; }

        /* Upgrades Section */
        .upgrades-section {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px; margin-bottom: 40px;
        }
        .upgrade-category {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 15px;
            padding: 20px; min-height: 300px;
        }
        .category-title {
            font-family: 'Orbitron', monospace; font-size: 1.3rem; font-weight: bold;
            margin-bottom: 20px; text-align: center; color: #00ffff;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .upgrade-item {
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px; padding: 15px; margin-bottom: 10px; cursor: pointer;
            transition: all 0.3s ease; position: relative; overflow: hidden;
        }
        .upgrade-item::before {
            content: ''; position: absolute; top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        .upgrade-item:hover::before { left: 100%; }
        .upgrade-item:hover {
            background: rgba(255, 255, 255, 0.15); transform: translateX(5px);
        }
        .upgrade-item:disabled {
            opacity: 0.5; cursor: not-allowed; background: rgba(255, 0, 0, 0.1);
        }
        .upgrade-name { font-weight: bold; margin-bottom: 5px; }
        .upgrade-cost { font-size: 0.9rem; opacity: 0.8; margin-bottom: 5px; }
        .upgrade-effect { font-size: 0.8rem; opacity: 0.7; }

        /* Fleet Tab */
        .fleet-composition {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px; margin-bottom: 30px;
        }
        .fleet-unit {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px;
            padding: 20px; text-align: center; transition: all 0.3s ease;
        }
        .fleet-unit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.3);
        }
        .unit-icon { font-size: 2.5rem; margin-bottom: 10px; display: block; }
        .unit-name { font-weight: bold; margin-bottom: 10px; }
        .unit-stats { font-size: 0.9rem; opacity: 0.8; margin-bottom: 15px; }
        .unit-count {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            margin-bottom: 10px;
        }
        .unit-btn {
            width: 30px; height: 30px; border: none; border-radius: 50%;
            background: rgba(0, 255, 255, 0.3); color: white; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s ease;
        }
        .unit-btn:hover { background: rgba(0, 255, 255, 0.5); }
        .unit-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Missions Tab */
        .missions-panel {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px; margin-bottom: 30px;
        }
        .mission-card {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 15px;
            padding: 20px; transition: all 0.3s ease;
        }
        .mission-card:hover {
            background: rgba(255, 255, 255, 0.1); transform: translateY(-3px);
        }
        .mission-card.completed {
            border-color: #4caf50; background: rgba(76, 175, 80, 0.1);
        }
        .mission-title { font-weight: bold; margin-bottom: 10px; color: #00ffff; }
        .mission-desc { font-size: 0.9rem; opacity: 0.8; margin-bottom: 15px; }
        .mission-progress {
            background: rgba(255, 255, 255, 0.1); border-radius: 8px; height: 8px;
            overflow: hidden; margin-bottom: 10px;
        }
        .mission-progress-bar {
            height: 100%; background: linear-gradient(45deg, #00ffff, #0066cc);
            transition: width 0.3s ease;
        }
        .mission-reward { font-size: 0.8rem; color: #ffc107; }
        .mission-claim {
            width: 100%; padding: 10px; margin-top: 10px;
            background: linear-gradient(45deg, #4caf50, #8bc34a); border: none;
            border-radius: 8px; color: #000; font-weight: bold; cursor: pointer;
        }
        .mission-claim:disabled {
            background: rgba(255, 255, 255, 0.2); color: rgba(255, 255, 255, 0.5);
        }

        /* Achievements Tab */
        .achievements-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px; margin-bottom: 30px; max-height: 70vh; overflow-y: auto;
        }
        .achievement-card {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 15px;
            padding: 20px; transition: all 0.3s ease; opacity: 0.5;
        }
        .achievement-card.unlocked {
            opacity: 1; border-color: #4caf50; background: rgba(76, 175, 80, 0.1);
        }
        .achievement-card:hover { transform: translateY(-3px); }
        .achievement-icon { font-size: 2rem; margin-bottom: 10px; display: block; }
        .achievement-name { font-weight: bold; margin-bottom: 5px; color: #00ffff; }
        .achievement-desc { font-size: 0.8rem; opacity: 0.8; }
        .achievement-reward { font-size: 0.7rem; color: #ffc107; margin-top: 5px; }

        /* Battle Effects */
        .floating-number {
            position: fixed; font-family: 'Orbitron', monospace; font-weight: bold;
            font-size: 1.8rem; color: #00ffff;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
            pointer-events: none; z-index: 1000; animation: floatUp 2.5s ease-out forwards;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
            50% { opacity: 1; transform: translateY(-50px) scale(1.3) rotate(180deg); }
            100% { opacity: 0; transform: translateY(-120px) scale(0.8) rotate(360deg); }
        }
        .particle {
            position: absolute; width: 6px; height: 6px; background: #00ffff;
            border-radius: 50%; pointer-events: none;
            animation: particleFloat 4s ease-out forwards;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }
        @keyframes particleFloat {
            0% { opacity: 1; transform: translate(0, 0) scale(1); }
            100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0); }
        }
        .combo-indicator {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-family: 'Orbitron', monospace; font-size: 3rem; font-weight: bold;
            color: #ff00ff; text-shadow: 0 0 30px rgba(255, 0, 255, 0.8);
            pointer-events: none; z-index: 999; opacity: 0; transition: all 0.4s ease;
        }
        .combo-indicator.show { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }

        /* Notifications */
        .notification {
            position: fixed; top: 20px; right: 20px;
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            color: #000; padding: 15px 20px; border-radius: 10px; font-weight: bold;
            transform: translateX(400px); transition: transform 0.5s ease; z-index: 1001;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.5); max-width: 300px;
        }
        .notification.show { transform: translateX(0); }
        .notification.achievement {
            background: linear-gradient(45deg, #ff9800, #ffc107);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.5);
        }
        .notification.warning {
            background: linear-gradient(45deg, #ff5722, #f44336);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.5);
        }

        /* Modal */
        .modal {
            position: fixed; inset: 0; background: rgba(0, 0, 0, 0.8);
            display: none; align-items: center; justify-content: center; z-index: 2000;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px;
            padding: 40px; max-width: 500px; width: 90%; text-align: center;
        }
        .modal-title {
            font-family: 'Orbitron', monospace; font-size: 1.5rem;
            color: #00ffff; margin-bottom: 20px;
        }
        .modal-button {
            padding: 15px 30px; margin: 10px;
            background: linear-gradient(45deg, #00ffff, #0066cc); border: none;
            border-radius: 10px; color: white; font-weight: bold; cursor: pointer;
            transition: all 0.3s ease;
        }
        .modal-button:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 255, 255, 0.4); }
        .modal-button.danger { background: linear-gradient(45deg, #ff5722, #f44336); }
        .modal-button.danger:hover { box-shadow: 0 10px 25px rgba(244, 67, 54, 0.4); }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .nav-tabs { flex-wrap: wrap; }
            .empire-stats { grid-template-columns: repeat(2, 1fr); }
            .header { grid-template-columns: 1fr; text-align: center; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-title">GALACTIC EMPIRE</div>
        <div class="loading-bar"><div class="loading-progress"></div></div>
        <p style="margin-top: 20px; opacity: 0.7;">Inicializando universo...</p>
    </div>

    <!-- Auth Screen -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-container">
            <div class="auth-title" id="authTitle">INICIAR SESI√ìN</div>
            <input type="text" class="auth-input" id="usernameInput" placeholder="Nombre de Usuario" maxlength="20" autocomplete="username">
            <input type="password" class="auth-input" id="passwordInput" placeholder="Contrase√±a" maxlength="30" autocomplete="current-password">
            <button class="auth-button" id="authButton">INICIAR SESI√ìN</button>
            <div style="margin-top: 20px;">
                <span id="authSwitchText">¬øNo tienes cuenta?</span>
                <span class="auth-switch" id="authSwitch">Reg√≠strate</span>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="prestigeModal">
        <div class="modal-content">
            <div class="modal-title">PRESTIGIO DISPONIBLE</div>
            <p>Has alcanzado <strong id="prestigeThresholdText">1,000,000</strong> de riqueza total.</p>
            <p>Al resetear ganar√°s <strong>+1 Prestigio</strong> y bonificaciones permanentes.</p>
            <p style="margin: 20px 0; color: #ff9800;">‚ö†Ô∏è Se reiniciar√°n todos los recursos y mejoras ‚ö†Ô∏è</p>
            <button class="modal-button" id="confirmPrestige">Confirmar Prestigio</button>
            <button class="modal-button danger" id="closePrestigeModal">Cancelar</button>
        </div>
    </div>

    <div class="modal" id="dimensionalModal">
        <div class="modal-content">
            <div class="modal-title">ASCENSI√ìN DIMENSIONAL</div>
            <p>Has alcanzado <strong id="dimensionalThresholdText">10</strong> de Prestigio.</p>
            <p>Al ascender ganar√°s <strong>+1 Dimensi√≥n</strong> y desbloquear√°s contenido trascendental.</p>
            <p style="margin: 20px 0; color: #ff00ff;">‚ú® Desbloquea nuevas mec√°nicas y multiplicadores ‚ú®</p>
            <p style="margin-bottom: 20px; color: #f44336;">üö® Resetea TODO excepto logros y dimensiones üö®</p>
            <button class="modal-button" id="confirmDimensional">Confirmar Ascensi√≥n</button>
            <button class="modal-button danger" id="closeDimensionalModal">Cancelar</button>
        </div>
    </div>

    <!-- Animated Stars Background -->
    <div class="stars" id="stars"></div>

    <!-- Cinematic Background -->
    <div class="space-bg"></div>
    
    <div class="container" id="mainContainer" style="display: none;">
        <header class="header">
            <div></div>
            <h1 class="game-title">GALACTIC EMPIRE</h1>
            <div class="player-info" id="playerInfo">
                <div class="player-avatar" id="playerAvatar">GE</div>
                <div class="player-details">
                    <div class="player-name" id="playerName">Comandante</div>
                    <div class="player-level" id="playerLevel">Nivel 1 - Recruit</div>
                </div>
                <button class="logout-btn" id="logoutBtn" title="Cerrar Sesi√≥n">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="empire">
                <i class="fas fa-crown"></i> IMPERIO
            </button>
            <button class="nav-tab" data-tab="fleet">
                <i class="fas fa-rocket"></i> FLOTA
            </button>
            <button class="nav-tab" data-tab="missions">
                <i class="fas fa-tasks"></i> MISIONES
            </button>
            <button class="nav-tab" data-tab="achievements">
                <i class="fas fa-medal"></i> LOGROS
            </button>
            <button class="nav-tab" data-tab="config">
                <i class="fas fa-cog"></i> CONFIG
            </button>
        </div>

        <!-- Empire Tab -->
        <div class="game-content active" id="empire-tab">
            <div class="empire-stats">
                <div class="stat-item">
                    <i class="fas fa-coins stat-icon" style="color: #ffff00;"></i>
                    <div class="stat-value" id="totalWealth">0</div>
                    <div class="stat-label">Riqueza Total</div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-users stat-icon" style="color: #00ffff;"></i>
                    <div class="stat-value" id="population">0</div>
                    <div class="stat-label">Poblaci√≥n</div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-rocket stat-icon" style="color: #ff00ff;"></i>
                    <div class="stat-value" id="fleetPower">0</div>
                    <div class="stat-label">Poder de Flota</div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-flask stat-icon" style="color: #4caf50;"></i>
                    <div class="stat-value" id="research">0</div>
                    <div class="stat-label">Investigaci√≥n</div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-crown stat-icon" style="color: #ffc107;"></i>
                    <div class="stat-value" id="prestige">0</div>
                    <div class="stat-label">Prestigio</div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-infinity stat-icon" style="color: #e91e63;"></i>
                    <div class="stat-value" id="dimensions">0</div>
                    <div class="stat-label">Dimensiones</div>
                </div>
            </div>

            <div class="resources-panel">
                <div class="resource-card">
                    <div class="resource-icon energy-icon">‚ö°</div>
                    <div class="resource-amount" id="energy">0</div>
                    <div class="resource-rate" id="energy-rate">0/s</div>
                </div>
                <div class="resource-card">
                    <div class="resource-icon mineral-icon">ü™®</div>
                    <div class="resource-amount" id="minerals">0</div>
                    <div class="resource-rate" id="minerals-rate">0/s</div>
                </div>
                <div class="resource-card">
                    <div class="resource-icon crystal-icon">üíé</div>
                    <div class="resource-amount" id="crystals">0</div>
                    <div class="resource-rate" id="crystals-rate">0/s</div>
                </div>
                <div class="resource-card">
                    <div class="resource-icon plasma-icon">üî•</div>
                    <div class="resource-amount" id="plasma">0</div>
                    <div class="resource-rate" id="plasma-rate">0/s</div>
                </div>
                <div class="resource-card">
                    <div class="resource-icon darkmatter-icon">üåå</div>
                    <div class="resource-amount" id="darkMatter">0</div>
                    <div class="resource-rate" id="darkMatter-rate">0/s</div>
                </div>
                <div class="resource-card">
                    <div class="resource-icon quantum-icon">‚öõÔ∏è</div>
                    <div class="resource-amount" id="quantum">0</div>
                    <div class="resource-rate" id="quantum-rate">0/s</div>
                </div>
                <div class="resource-card">
                    <div class="resource-icon infinity-icon">‚ôæÔ∏è</div>
                    <div class="resource-amount" id="infinity">0</div>
                    <div class="resource-rate" id="infinity-rate">0/s</div>
                </div>
            </div>

            <div class="main-clicker" id="mainClicker">
                <div class="clicker-core">
                    <div class="clicker-text">MINAR</div>
                    <div class="clicker-power" id="clickPower">+1</div>
                    <div class="clicker-text" id="autoClickStatus"></div>
                </div>
            </div>

            <div class="upgrades-section">
                <div class="upgrade-category">
                    <div class="category-title">
                        <i class="fas fa-hammer"></i> INFRAESTRUCTURA
                    </div>
                    <div class="upgrade-item" id="buy-miner">
                        <div class="upgrade-name">Minero Cu√°ntico</div>
                        <div class="upgrade-cost">Costo: <span id="miner-cost">10</span> ‚ö°</div>
                        <div class="upgrade-effect">+1 ‚ö°/s por minero</div>
                    </div>
                    <div class="upgrade-item" id="buy-quarry">
                        <div class="upgrade-name">Cantera Asteroidal</div>
                        <div class="upgrade-cost">Costo: <span id="quarry-cost">50</span> ‚ö°</div>
                        <div class="upgrade-effect">+3 ü™®/s por cantera</div>
                    </div>
                    <div class="upgrade-item" id="buy-crystal-farm">
                        <div class="upgrade-name">Granja de Cristales</div>
                        <div class="upgrade-cost">Costo: <span id="crystal-cost">200</span> ‚ö°</div>
                        <div class="upgrade-effect">+2 üíé/s por granja</div>
                    </div>
                    <div class="upgrade-item" id="buy-power-plant">
                        <div class="upgrade-name">Planta de Energ√≠a Estelar</div>
                        <div class="upgrade-cost">Costo: <span id="power-cost">500</span> ‚ö°</div>
                        <div class="upgrade-effect">+10 ‚ö°/s y +10 poblaci√≥n</div>
                    </div>
                </div>

                <div class="upgrade-category">
                    <div class="category-title">
                        <i class="fas fa-microchip"></i> TECNOLOG√çA
                    </div>
                    <div class="upgrade-item" id="upgrade-click">
                        <div class="upgrade-name">Potencia de Clic</div>
                        <div class="upgrade-cost">Costo: <span id="click-cost">100</span> ‚ö°</div>
                        <div class="upgrade-effect">+1 por clic manual</div>
                    </div>
                    <div class="upgrade-item" id="upgrade-multiplier">
                        <div class="upgrade-name">Multiplicador Global</div>
                        <div class="upgrade-cost">Costo: <span id="multiplier-cost">1000</span> ‚ö°</div>
                        <div class="upgrade-effect">x2 todos los recursos</div>
                    </div>
                    <div class="upgrade-item" id="upgrade-auto-click">
                        <div class="upgrade-name">Auto-Clickeador</div>
                        <div class="upgrade-cost">Costo: <span id="auto-click-cost">5000</span> ‚ö°</div>
                        <div class="upgrade-effect">+1 clic/s autom√°tico</div>
                    </div>
                    <div class="upgrade-item" id="upgrade-combo">
                        <div class="upgrade-name">Acelerador de Combo</div>
                        <div class="upgrade-cost">Costo: <span id="combo-cost">10000</span> ‚ö°</div>
                        <div class="upgrade-effect">+100% velocidad combo</div>
                    </div>
                </div>

                <div class="upgrade-category">
                    <div class="category-title">
                        <i class="fas fa-atom"></i> TRASCENDENTAL
                    </div>
                    <div class="upgrade-item" id="buy-plasma">
                        <div class="upgrade-name">Extractor de Plasma</div>
                        <div class="upgrade-cost">Costo: <span id="plasma-cost">1000</span> üíé</div>
                        <div class="upgrade-effect">+2 üî•/s por extractor</div>
                    </div>
                    <div class="upgrade-item" id="buy-darkmatter">
                        <div class="upgrade-name">Colector Materia Oscura</div>
                        <div class="upgrade-cost">Costo: <span id="darkmatter-cost">500</span> üî•</div>
                        <div class="upgrade-effect">+0.2 üåå/s por colector</div>
                    </div>
                    <div class="upgrade-item" id="buy-quantum">
                        <div class="upgrade-name">Computadora Cu√°ntica</div>
                        <div class="upgrade-cost">Costo: <span id="quantum-cost">100</span> üåå</div>
                        <div class="upgrade-effect">+0.05 ‚öõÔ∏è/s por computadora</div>
                    </div>
                    <div class="upgrade-item" id="buy-portal">
                        <div class="upgrade-name">Portal DimensionaL</div>
                        <div class="upgrade-cost">Costo: <span id="portal-cost">50</span> ‚öõÔ∏è</div>
                        <div class="upgrade-effect">+0.01 ‚ôæÔ∏è/s y +100% todo</div>
                    </div>
                </div>

                <div class="upgrade-category">
                    <div class="category-title">
                        <i class="fas fa-scroll"></i> INVESTIGACI√ìN
                    </div>
                    <div class="upgrade-item" id="buy-laboratory">
                        <div class="upgrade-name">Laboratorio de Investigaci√≥n</div>
                        <div class="upgrade-cost">Costo: <span id="lab-cost">5000</span> ü™®</div>
                        <div class="upgrade-effect">+5 Investigaci√≥n/s y desbloquea nuevas mejoras</div>
                    </div>
                    <div class="upgrade-item" id="buy-shipyard">
                        <div class="upgrade-name">Astillero Orbital</div>
                        <div class="upgrade-cost">Costo: <span id="shipyard-cost">10000</span> üíé</div>
                        <div class="upgrade-effect">+100 Poder de Flota/s</div>
                    </div>
                    <div class="upgrade-item" id="buy-station">
                        <div class="upgrade-name">Estaci√≥n Espacial</div>
                        <div class="upgrade-cost">Costo: <span id="station-cost">25000</span> üî•</div>
                        <div class="upgrade-effect">+10% a todos los recursos</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fleet Tab -->
        <div class="game-content" id="fleet-tab">
            <div class="fleet-composition">
                <div class="fleet-unit">
                    <i class="fas fa-fighter-jet unit-icon" style="color: #00ffff;"></i>
                    <div class="unit-name">Cazas Interceptores</div>
                    <div class="unit-stats">Ataque: 10 | Poder: 5</div>
                    <div class="unit-count">
                        <button class="unit-btn" id="fighter-minus">-</button>
                        <span id="fighter-count">0</span>
                        <button class="unit-btn" id="fighter-plus">+</button>
                    </div>
                    <div style="font-size: 0.8rem; opacity: 0.7;">Costo: 100 ‚ö°</div>
                </div>

                <div class="fleet-unit">
                    <i class="fas fa-space-station-moon-alt unit-icon" style="color: #ff00ff;"></i>
                    <div class="unit-name">Cruceros de Batalla</div>
                    <div class="unit-stats">Ataque: 50 | Poder: 25</div>
                    <div class="unit-count">
                        <button class="unit-btn" id="cruiser-minus">-</button>
                        <span id="cruiser-count">0</span>
                        <button class="unit-btn" id="cruiser-plus">+</button>
                    </div>
                    <div style="font-size: 0.8rem; opacity: 0.7;">Costo: 500 üíé</div>
                </div>

                <div class="fleet-unit">
                    <i class="fas fa-rocket unit-icon" style="color: #ffc107;"></i>
                    <div class="unit-name">Bombarderos Pesados</div>
                    <div class="unit-stats">Ataque: 100 | Poder: 50</div>
                    <div class="unit-count">
                        <button class="unit-btn" id="bomber-minus">-</button>
                        <span id="bomber-count">0</span>
                        <button class="unit-btn" id="bomber-plus">+</button>
                    </div>
                    <div style="font-size: 0.8rem; opacity: 0.7;">Costo: 1000 üî•</div>
                </div>

                <div class="fleet-unit">
                    <i class="fas fa-satellite unit-icon" style="color: #4caf50;"></i>
                    <div class="unit-name">Sat√©lites de Defensa</div>
                    <div class="unit-stats">Defensa: 200 | Poder: 10</div>
                    <div class="unit-count">
                        <button class="unit-btn" id="defense-minus">-</button>
                        <span id="defense-count">0</span>
                        <button class="unit-btn" id="defense-plus">+</button>
                    </div>
                    <div style="font-size: 0.8rem; opacity: 0.7;">Costo: 200 üåå</div>
                </div>

                <div class="fleet-unit">
                    <i class="fas fa-galaxy unit-icon" style="color: #e91e63;"></i>
                    <div class="unit-name">Acorazados Estelares</div>
                    <div class="unit-stats">Ataque: 500 | Poder: 250</div>
                    <div class="unit-count">
                        <button class="unit-btn" id="battleship-minus">-</button>
                        <span id="battleship-count">0</span>
                        <button class="unit-btn" id="battleship-plus">+</button>
                    </div>
                    <div style="font-size: 0.8rem; opacity: 0.7;">Costo: 5000 üåå</div>
                </div>

                <div class="fleet-unit">
                    <i class="fas fa-meteor unit-icon" style="color: #9c27b0;"></i>
                    <div class="unit-name">Destructor de Mundos</div>
                    <div class="unit-stats">Ataque: 1000 | Poder: 500</div>
                    <div class="unit-count">
                        <button class="unit-btn" id="destroyer-minus">-</button>
                        <span id="destroyer-count">0</span>
                        <button class="unit-btn" id="destroyer-plus">+</button>
                    </div>
                    <div style="font-size: 0.8rem; opacity: 0.7;">Costo: 10000 ‚öõÔ∏è</div>
                </div>
            </div>
        </div>

        <!-- Missions Tab -->
        <div class="game-content" id="missions-tab">
            <div class="missions-panel" id="missionsPanel">
                <!-- Misiones generadas din√°micamente -->
            </div>
        </div>

        <!-- Achievements Tab -->
        <div class="game-content" id="achievements-tab">
            <div class="achievements-grid" id="achievementsGrid">
                <!-- Logros generados din√°micamente -->
            </div>
        </div>

        <!-- Config Tab -->
        <div class="game-content" id="config-tab">
            <div class="upgrades-section">
                <div class="upgrade-category">
                    <div class="category-title">
                        <i class="fas fa-cog"></i> AJUSTES
                    </div>
                    <div class="upgrade-item" id="export-save">
                        <div class="upgrade-name">Exportar Partida</div>
                        <div class="upgrade-effect">Guarda tu progreso en un archivo</div>
                    </div>
                    <div class="upgrade-item" id="import-save">
                        <div class="upgrade-name">Importar Partida</div>
                        <div class="upgrade-effect">Carga tu progreso desde un archivo</div>
                    </div>
                    <div class="upgrade-item" id="reset-game">
                        <div class="upgrade-name" style="color: #f44336;">REINICIAR TODO</div>
                        <div class="upgrade-effect">‚ö†Ô∏è Elimina TODO el progreso ‚ö†Ô∏è</div>
                    </div>
                </div>
                <div class="upgrade-category">
                    <div class="category-title">
                        <i class="fas fa-chart-line"></i> ESTAD√çSTICAS
                    </div>
                    <div style="font-size: 0.9rem; opacity: 0.8; line-height: 1.6;">
                        <div>Clicks Totales: <span id="totalClicksStat">0</span></div>
                        <div>Mejor Combo: <span id="bestComboStat">0</span>x</div>
                        <div>Recursos Minados: <span id="resourcesMinedStat">0</span></div>
                        <div>Tiempo de Juego: <span id="playTimeStat">0h 0m 0s</span></div>
                        <div>Logros Desbloqueados: <span id="achievementsStat">0</span>/<span id="achievementsTotal">0</span></div>
                        <div>Misiones Completadas: <span id="missionsStat">0</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Combo Indicator -->
    <div class="combo-indicator" id="comboIndicator">
        ¬°COMBO x<span id="comboMultiplier">1</span>!
    </div>

    <!-- Notification System -->
    <div id="notificationContainer"></div>

    <script>
        class GalacticEmpireInfinity {
            constructor() {
                this.isLoaded = false;
                this.currentUser = null;
                this.currentTab = 'empire';
                this.gameLoopInterval = null;
                this.autoClickInterval = null;
                this.lastUpdate = Date.now();
                
                // Game Data
                this.resources = {
                    energy: 0, minerals: 0, crystals: 0, plasma: 0,
                    darkMatter: 0, quantum: 0, infinity: 0
                };

                this.generators = {
                    miners: 0, quarries: 0, crystalFarms: 0, powerPlants: 0,
                    plasmaExtractors: 0, darkMatterCollectors: 0,
                    quantumComputers: 0, dimensionalPortals: 0
                };

                this.upgrades = {
                    clickPower: 1, globalMultiplier: 1, comboSpeed: 1,
                    autoClicker: 0, spaceStation: 0, laboratory: 0,
                    shipyard: 0, quantumPortal: 0
                };

                this.fleet = {
                    fighters: 0, cruisers: 0, bombers: 0,
                    defenses: 0, battleships: 0, destroyers: 0
                };

                this.empire = {
                    population: 0, fleetPower: 0, research: 0,
                    prestige: 0, dimensions: 0, totalWealth: 0,
                    level: 1, missionPoints: 0
                };

                this.stats = {
                    totalClicks: 0, bestCombo: 0, resourcesMined: 0,
                    playTime: 0, achievements: new Set(), missionsCompleted: 0
                };

                this.combo = { count: 0, multiplier: 1, lastClick: 0, timer: null };

                this.missions = [];
                this.achievements = [];
                this.prestigeThreshold = 1000000;
                this.dimensionalThreshold = 10;
                
                this.init();
            }

            init() {
                this.createStars();
                this.setupAuth();
                this.setupNavigation();
                this.setupEventListeners();
                this.initializeMissions();
                this.initializeAchievements();
                this.hideLoadingScreen();
            }

            createStars() {
                const starsContainer = document.getElementById('stars');
                for (let i = 0; i < 150; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    star.style.animationDelay = Math.random() * 3 + 's';
                    starsContainer.appendChild(star);
                }
            }

            setupAuth() {
                const authScreen = document.getElementById('authScreen');
                const authButton = document.getElementById('authButton');
                const authSwitch = document.getElementById('authSwitch');
                const usernameInput = document.getElementById('usernameInput');
                const passwordInput = document.getElementById('passwordInput');

                let isLogin = true;

                authSwitch.addEventListener('click', () => {
                    isLogin = !isLogin;
                    document.getElementById('authTitle').textContent = isLogin ? 'INICIAR SESI√ìN' : 'REGISTRARSE';
                    authButton.textContent = isLogin ? 'INICIAR SESI√ìN' : 'REGISTRARSE';
                    document.getElementById('authSwitchText').textContent = isLogin ? '¬øNo tienes cuenta?' : '¬øYa tienes cuenta?';
                    authSwitch.textContent = isLogin ? 'Reg√≠strate' : 'Inicia Sesi√≥n';
                });

                authButton.addEventListener('click', () => this.handleAuth(usernameInput, passwordInput, isLogin));
                [usernameInput, passwordInput].forEach(input => {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') authButton.click();
                    });
                });
            }

            handleAuth(usernameInput, passwordInput, isLogin) {
                const username = usernameInput.value.trim();
                const password = passwordInput.value.trim();

                if (username.length < 3) {
                    this.showNotification('El nombre de usuario debe tener al menos 3 caracteres', 'warning');
                    return;
                }
                if (password.length < 4) {
                    this.showNotification('La contrase√±a debe tener al menos 4 caracteres', 'warning');
                    return;
                }

                const users = JSON.parse(localStorage.getItem('galacticUsers') || '{}');
                
                if (isLogin) {
                    if (users[username] && users[username].password === password) {
                        this.loginUser(username, users[username]);
                    } else {
                        this.showNotification('Usuario o contrase√±a incorrectos', 'warning');
                    }
                } else {
                    if (users[username]) {
                        this.showNotification('El usuario ya existe', 'warning');
                    } else {
                        users[username] = { password, createdAt: Date.now() };
                        localStorage.setItem('galacticUsers', JSON.stringify(users));
                        this.loginUser(username, users[username]);
                        this.showNotification('¬°Usuario registrado exitosamente!', 'success');
                    }
                }
            }

            loginUser(username, userData) {
                this.currentUser = username;
                document.getElementById('playerName').textContent = username;
                document.getElementById('playerAvatar').textContent = username.substring(0, 2).toUpperCase();
                
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'block';
                
                this.loadGame();
                this.startGameLoop();
                this.updateDisplay();
                this.showNotification(`¬°Bienvenido, ${username}!`, 'success');
            }

            setupNavigation() {
                const tabs = document.querySelectorAll('.nav-tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        this.switchTab(tab.dataset.tab);
                    });
                });
                document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
            }

            switchTab(tabName) {
                document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.game-content').forEach(content => content.classList.remove('active'));
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');
                this.currentTab = tabName;
            }

            logout() {
                this.saveGame();
                this.currentUser = null;
                if (this.autoClickInterval) clearInterval(this.autoClickInterval);
                if (this.gameLoopInterval) clearInterval(this.gameLoopInterval);
                document.getElementById('mainContainer').style.display = 'none';
                document.getElementById('authScreen').style.display = 'flex';
                document.getElementById('usernameInput').value = '';
                document.getElementById('passwordInput').value = '';
            }

            setupEventListeners() {
                // Main clicker
                const clicker = document.getElementById('mainClicker');
                clicker.addEventListener('click', (e) => this.handleClick(e));
                clicker.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.handleClick(e);
                });

                // Fleet controls
                this.setupFleetControls();

                // Config buttons
                document.getElementById('export-save').addEventListener('click', () => this.exportSave());
                document.getElementById('import-save').addEventListener('click', () => this.importSave());
                document.getElementById('reset-game').addEventListener('click', () => this.resetGame());

                // Modal controls
                document.getElementById('confirmPrestige').addEventListener('click', () => this.prestige());
                document.getElementById('closePrestigeModal').addEventListener('click', () => this.closeModal('prestigeModal'));
                document.getElementById('confirmDimensional').addEventListener('click', () => this.dimensionalAscension());
                document.getElementById('closeDimensionalModal').addEventListener('click', () => this.closeModal('dimensionalModal'));

                // Upgrade buttons
                this.setupUpgradeButtons();
            }

            setupFleetControls() {
                const units = {
                    fighter: { cost: 100, resource: 'energy', power: 5 },
                    cruiser: { cost: 500, resource: 'crystals', power: 25 },
                    bomber: { cost: 1000, resource: 'plasma', power: 50 },
                    defense: { cost: 200, resource: 'darkMatter', power: 10 },
                    battleship: { cost: 5000, resource: 'darkMatter', power: 250 },
                    destroyer: { cost: 10000, resource: 'quantum', power: 500 }
                };

                Object.keys(units).forEach(unit => {
                    document.getElementById(`${unit}-plus`).addEventListener('click', () => 
                        this.buyUnit(unit, units[unit]));
                    document.getElementById(`${unit}-minus`).addEventListener('click', () => 
                        this.sellUnit(unit, units[unit]));
                });
            }

            buyUnit(unit, config) {
                if (this.resources[config.resource] >= config.cost) {
                    this.resources[config.resource] -= config.cost;
                    this.fleet[unit + 's']++;
                    this.updateFleetPower();
                    this.updateDisplay();
                    this.checkMissionProgress('buyFleet', 1);
                    this.showNotification(`¬°${unit} comprado!`);
                }
            }

            sellUnit(unit, config) {
                if (this.fleet[unit + 's'] > 0) {
                    this.fleet[unit + 's']--;
                    this.resources[config.resource] += Math.floor(config.cost * 0.7);
                    this.updateFleetPower();
                    this.updateDisplay();
                    this.showNotification(`${unit} vendido`);
                }
            }

            updateFleetPower() {
                const power = { fighters: 5, cruisers: 25, bombers: 50, defenses: 10, battleships: 250, destroyers: 500 };
                this.empire.fleetPower = Object.keys(this.fleet).reduce((sum, unit) => 
                    sum + this.fleet[unit] * power[unit], 0);
            }

            setupUpgradeButtons() {
                // Infrastructure
                document.getElementById('buy-miner').addEventListener('click', () => 
                    this.buyGenerator('miners', 'energy', 10, 1));
                document.getElementById('buy-quarry').addEventListener('click', () => 
                    this.buyGenerator('quarries', 'energy', 50, 3));
                document.getElementById('buy-crystal-farm').addEventListener('click', () => 
                    this.buyGenerator('crystalFarms', 'energy', 200, 2));
                document.getElementById('buy-power-plant').addEventListener('click', () => 
                    this.buyGenerator('powerPlants', 'energy', 500, 10));

                // Technology
                document.getElementById('upgrade-click').addEventListener('click', () => 
                    this.buyUpgrade('clickPower', 'energy', 100, 1));
                document.getElementById('upgrade-multiplier').addEventListener('click', () => 
                    this.buyUpgrade('globalMultiplier', 'energy', 1000, 2));
                document.getElementById('upgrade-auto-click').addEventListener('click', () => 
                    this.buyUpgrade('autoClicker', 'energy', 5000, 1));
                document.getElementById('upgrade-combo').addEventListener('click', () => 
                    this.buyUpgrade('comboSpeed', 'energy', 10000, 1));

                // Advanced
                document.getElementById('buy-plasma').addEventListener('click', () => 
                    this.buyGenerator('plasmaExtractors', 'crystals', 1000, 2));
                document.getElementById('buy-darkmatter').addEventListener('click', () => 
                    this.buyGenerator('darkMatterCollectors', 'plasma', 500, 0.2));
                document.getElementById('buy-quantum').addEventListener('click', () => 
                    this.buyGenerator('quantumComputers', 'darkMatter', 100, 0.05));
                document.getElementById('buy-portal').addEventListener('click', () => 
                    this.buyGenerator('dimensionalPortals', 'quantum', 50, 0.01));

                // Research
                document.getElementById('buy-laboratory').addEventListener('click', () => 
                    this.buyGenerator('laboratory', 'minerals', 5000, 5));
                document.getElementById('buy-shipyard').addEventListener('click', () => 
                    this.buyGenerator('shipyard', 'crystals', 10000, 100));
                document.getElementById('buy-station').addEventListener('click', () => 
                    this.buyGenerator('spaceStation', 'plasma', 25000, 0));
            }

            buyGenerator(type, costResource, baseCost, rate) {
                const cost = Math.floor(baseCost * Math.pow(1.15, this.generators[type]));
                if (this.resources[costResource] >= cost) {
                    this.resources[costResource] -= cost;
                    this.generators[type]++;
                    if (type === 'spaceStation') this.empire.population += 10;
                    if (type === 'laboratory') this.empire.research += rate;
                    if (type === 'shipyard') this.empire.fleetPower += rate;
                    if (type === 'dimensionalPortals') this.upgrades.globalMultiplier *= 2;
                    
                    this.showNotification(`¬°${type} mejorado!`);
                    if (type === 'autoClicker') this.updateAutoClicker();
                    this.updateDisplay();
                    this.checkMissionProgress('buyUpgrades', 1);
                }
            }

            buyUpgrade(type, costResource, baseCost, effect) {
                const cost = type === 'globalMultiplier' ? 
                    baseCost * this.upgrades[type] : baseCost * this.upgrades[type];
                
                if (this.resources[costResource] >= cost) {
                    this.resources[costResource] -= cost;
                    
                    if (type === 'globalMultiplier' || type === 'comboSpeed') {
                        this.upgrades[type] = Math.max(0.1, this.upgrades[type] + effect);
                    } else {
                        this.upgrades[type] += effect;
                    }
                    
                    this.showNotification(`¬°${type} mejorado!`);
                    if (type === 'autoClicker') this.updateAutoClicker();
                    this.updateDisplay();
                    this.checkMissionProgress('buyUpgrades', 1);
                }
            }

            updateAutoClicker() {
                if (this.autoClickInterval) clearInterval(this.autoClickInterval);
                if (this.upgrades.autoClicker > 0) {
                    const interval = 1000 / this.upgrades.autoClicker;
                    this.autoClickInterval = setInterval(() => this.autoClick(), interval);
                }
            }

            autoClick() {
                const clickValue = Math.floor(this.upgrades.clickPower * this.upgrades.globalMultiplier * (1 + this.upgrades.spaceStation * 0.1));
                this.resources.energy += clickValue;
                this.stats.resourcesMined += clickValue;
                this.updateDisplay();
            }

            handleClick(e) {
                if (!this.isLoaded || this.currentTab !== 'empire') return;
                
                this.stats.totalClicks++;
                
                const now = Date.now();
                if (now - this.combo.lastClick < 1000 / this.upgrades.comboSpeed) {
                    this.combo.count++;
                    if (this.combo.count > this.combo.multiplier * 10) {
                        this.combo.multiplier = Math.floor(this.combo.count / 10) + 1;
                        this.showCombo();
                    }
                } else {
                    this.combo.count = 1;
                    this.combo.multiplier = 1;
                }
                this.combo.lastClick = now;

                const baseClick = this.upgrades.clickPower * this.combo.multiplier;
                const clickValue = Math.floor(baseClick * this.upgrades.globalMultiplier * (1 + this.upgrades.spaceStation * 0.1));
                
                this.resources.energy += clickValue;
                this.stats.resourcesMined += clickValue;

                this.createFloatingNumber(
                    e.clientX || e.touches[0].clientX,
                    e.clientY || e.touches[0].clientY,
                    `+${clickValue}`
                );
                this.createParticles(
                    e.clientX || e.touches[0].clientX,
                    e.clientY || e.touches[0].clientY
                );

                this.checkAchievements();
                this.checkMissionProgress('click', 1);
                this.updateDisplay();
            }

            createFloatingNumber(x, y, text) {
                const floater = document.createElement('div');
                floater.className = 'floating-number';
                floater.textContent = text;
                floater.style.left = x + 'px';
                floater.style.top = y + 'px';
                document.body.appendChild(floater);
                setTimeout(() => floater.remove(), 2500);
            }

            createParticles(x, y) {
                for (let i = 0; i < 12; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = x + 'px';
                    particle.style.top = y + 'px';
                    
                    const angle = (i / 12) * Math.PI * 2;
                    const distance = 60 + Math.random() * 80;
                    particle.style.setProperty('--dx', Math.cos(angle) * distance + 'px');
                    particle.style.setProperty('--dy', Math.sin(angle) * distance + 'px');
                    
                    document.body.appendChild(particle);
                    setTimeout(() => particle.remove(), 4000);
                }
            }

            showCombo() {
                const indicator = document.getElementById('comboIndicator');
                const multiplier = document.getElementById('comboMultiplier');
                multiplier.textContent = this.combo.multiplier;
                indicator.classList.add('show');
                setTimeout(() => indicator.classList.remove('show'), 1500);
                if (this.combo.multiplier > this.stats.bestCombo) this.stats.bestCombo = this.combo.multiplier;
            }

            generateResources() {
                const multiplier = this.upgrades.globalMultiplier * (1 + this.upgrades.spaceStation * 0.1) * Math.pow(2, this.empire.dimensions);
                
                this.resources.energy += this.generators.miners * 1 * multiplier / 60;
                this.resources.energy += this.generators.powerPlants * 10 * multiplier / 60;
                this.resources.minerals += this.generators.quarries * 3 * multiplier / 60;
                this.resources.crystals += this.generators.crystalFarms * 2 * multiplier / 60;
                this.resources.plasma += this.generators.plasmaExtractors * 2 * multiplier / 60;
                this.resources.darkMatter += this.generators.darkMatterCollectors * 0.2 * multiplier / 60;
                this.resources.quantum += this.generators.quantumComputers * 0.05 * multiplier / 60;
                this.resources.infinity += this.generators.dimensionalPortals * 0.01 * multiplier / 60;
                
                this.empire.fleetPower += this.upgrades.shipyard * 100 / 60;
                this.empire.research += this.upgrades.laboratory * 5 / 60;
                this.empire.infinity += this.upgrades.quantumPortal * 0.1 / 60;
                
                this.empire.totalWealth = Object.values(this.resources).reduce((sum, val) => sum + val, 0);
                
                const newLevel = Math.floor(this.empire.prestige / 5) + this.empire.dimensions * 10 + 1;
                if (newLevel > this.empire.level) {
                    this.empire.level = newLevel;
                    this.updatePlayerLevel();
                }

                if (this.empire.totalWealth >= this.prestigeThreshold) {
                    this.showModal('prestigeModal');
                }

                if (this.empire.prestige >= this.dimensionalThreshold && this.empire.dimensions < 10) {
                    this.showModal('dimensionalModal');
                }
            }

            updatePlayerLevel() {
                const tiers = [
                    'Recruit', 'Cadet', 'Soldier', 'Veteran', 'Sergeant',
                    'Lieutenant', 'Captain', 'Major', 'Colonel', 'General',
                    'Commander', 'Admiral', 'Warlord', 'Emperor', 'Overlord',
                    'Cosmic Entity', 'Dimensional Lord', 'Reality Weaver'
                ];
                const tier = Math.floor(this.empire.level / 10);
                const levelName = tiers[Math.min(tier, tiers.length - 1)] || 'Eternal';
                document.getElementById('playerLevel').textContent = `Nivel ${this.empire.level} - ${levelName}`;
            }

            prestige() {
                this.empire.prestige++;
                this.prestigeThreshold *= 10;
                this.closeModal('prestigeModal');
                
                Object.keys(this.resources).forEach(resource => {
                    this.resources[resource] = Math.floor(this.resources[resource] * 0.1);
                });
                
                this.generators = {
                    miners: 0, quarries: 0, crystalFarms: 0, powerPlants: 0,
                    plasmaExtractors: 0, darkMatterCollectors: 0,
                    quantumComputers: 0, dimensionalPortals: 0
                };

                this.upgrades = {
                    clickPower: Math.max(1, this.upgrades.clickPower * 0.5),
                    globalMultiplier: 1, comboSpeed: 1,
                    autoClicker: 0, spaceStation: 0, laboratory: 0,
                    shipyard: 0, quantumPortal: 0
                };

                this.fleet = { fighters: 0, cruisers: 0, bombers: 0, defenses: 0, battleships: 0, destroyers: 0 };
                this.empire.fleetPower = 0;
                this.empire.research = 0;
                this.empire.population = 0;
                
                if (this.autoClickInterval) clearInterval(this.autoClickInterval);
                this.updateAutoClicker();
                this.updateDisplay();
                this.showNotification(`¬°PRESTIGIO ALCANZADO! +1 Prestigio`, 'achievement');
                this.checkMissionProgress('prestige', 1);
            }

            dimensionalAscension() {
                this.empire.dimensions++;
                this.closeModal('dimensionalModal');
                
                // Reset everything except achievements and dimensions
                this.resources = {
                    energy: 0, minerals: 0, crystals: 0, plasma: 0,
                    darkMatter: 0, quantum: 0, infinity: 0
                };
                this.generators = {
                    miners: 0, quarries: 0, crystalFarms: 0, powerPlants: 0,
                    plasmaExtractors: 0, darkMatterCollectors: 0,
                    quantumComputers: 0, dimensionalPortals: 0
                };
                this.upgrades = {
                    clickPower: 1, globalMultiplier: 1, comboSpeed: 1,
                    autoClicker: 0, spaceStation: 0, laboratory: 0,
                    shipyard: 0, quantumPortal: 0
                };
                this.fleet = { fighters: 0, cruisers: 0, bombers: 0, defenses: 0, battleships: 0, destroyers: 0 };
                this.empire.fleetPower = 0;
                this.empire.research = 0;
                this.empire.population = 0;
                this.empire.prestige = 0;
                this.prestigeThreshold = 1000000;
                
                if (this.autoClickInterval) clearInterval(this.autoClickInterval);
                this.updateAutoClicker();
                this.updateDisplay();
                this.showNotification(`¬°ASCENSI√ìN DIMENSIONAL! +1 Dimensi√≥n`, 'achievement');
                this.checkMissionProgress('dimensional', 1);
            }

            showModal(modalId) {
                const modal = document.getElementById(modalId);
                modal.classList.add('active');
            }

            closeModal(modalId) {
                const modal = document.getElementById(modalId);
                modal.classList.remove('active');
            }

            initializeMissions() {
                this.missions = [
                    {
                        id: 'firstClick', name: 'Primeros Pasos', description: 'Haz 100 clics',
                        target: 100, current: 0, type: 'click', reward: { energy: 100 }, claimed: false
                    },
                    {
                        id: 'miner10', name: 'Industrializaci√≥n', description: 'Compra 10 mineros',
                        target: 10, current: 0, type: 'buyUpgrades', reward: { minerals: 500 }, claimed: false
                    },
                    {
                        id: 'fleet100', name: 'Armada Inicial', description: 'Alcanza 100 de poder de flota',
                        target: 100, current: 0, type: 'fleetPower', reward: { crystals: 1000 }, claimed: false
                    },
                    {
                        id: 'wealth100k', name: 'Acumulaci√≥n', description: 'Alcanza 100,000 de riqueza total',
                        target: 100000, current: 0, type: 'wealth', reward: { plasma: 100 }, claimed: false
                    },
                    {
                        id: 'combo50x', name: 'Maestro del Ritmo', description: 'Alcanza un combo x50',
                        target: 50, current: 0, type: 'combo', reward: { darkMatter: 10 }, claimed: false
                    },
                    {
                        id: 'prestige1', name: 'Renacimiento', description: 'Obt√©n tu primer prestigio',
                        target: 1, current: 0, type: 'prestige', reward: { quantum: 5 }, claimed: false
                    },
                    {
                        id: 'dimensional5', name: 'Viajador Dimensional', description: 'Alcanza 5 dimensiones',
                        target: 5, current: 0, type: 'dimensional', reward: { infinity: 1 }, claimed: false
                    }
                ];
                this.renderMissions();
            }

            renderMissions() {
                const panel = document.getElementById('missionsPanel');
                panel.innerHTML = '';
                this.missions.forEach(mission => {
                    const card = document.createElement('div');
                    card.className = `mission-card ${mission.claimed ? 'completed' : ''}`;
                    card.innerHTML = `
                        <div class="mission-title">${mission.name}</div>
                        <div class="mission-desc">${mission.description}</div>
                        <div class="mission-progress">
                            <div class="mission-progress-bar" style="width: ${Math.min(100, (mission.current / mission.target) * 100)}%"></div>
                        </div>
                        <div class="mission-reward">Recompensa: ${this.parseReward(mission.reward)}</div>
                        <button class="mission-claim" ${mission.current < mission.target || mission.claimed ? 'disabled' : ''}>
                            ${mission.claimed ? 'Completado' : 'Reclamar'}
                        </button>
                    `;
                    
                    const button = card.querySelector('.mission-claim');
                    button.addEventListener('click', () => this.claimMission(mission.id));
                    
                    panel.appendChild(card);
                });
            }

            parseReward(reward) {
                return Object.entries(reward).map(([key, value]) => {
                    const icons = {
                        energy: '‚ö°', minerals: 'ü™®', crystals: 'üíé',
                        plasma: 'üî•', darkMatter: 'üåå', quantum: '‚öõÔ∏è', infinity: '‚ôæÔ∏è'
                    };
                    return `${value} ${icons[key] || key}`;
                }).join(', ');
            }

            checkMissionProgress(type, amount) {
                let updated = false;
                this.missions.forEach(mission => {
                    if (mission.type === type && !mission.claimed) {
                        if (type === 'click') {
                            mission.current = Math.min(mission.target, mission.current + amount);
                        } else if (type === 'buyUpgrades') {
                            mission.current = this.generators.miners + this.generators.quarries + this.generators.crystalFarms;
                        } else if (type === 'fleetPower') {
                            mission.current = this.empire.fleetPower;
                        } else if (type === 'wealth') {
                            mission.current = this.empire.totalWealth;
                        } else if (type === 'combo') {
                            mission.current = Math.max(mission.current, this.combo.multiplier);
                        } else if (type === 'prestige') {
                            mission.current = this.empire.prestige;
                        } else if (type === 'dimensional') {
                            mission.current = this.empire.dimensions;
                        }
                        updated = true;
                    }
                });
                if (updated) this.renderMissions();
            }

            claimMission(missionId) {
                const mission = this.missions.find(m => m.id === missionId);
                if (mission && mission.current >= mission.target && !mission.claimed) {
                    mission.claimed = true;
                    Object.entries(mission.reward).forEach(([resource, amount]) => {
                        this.resources[resource] += amount;
                    });
                    this.empire.missionPoints++;
                    this.stats.missionsCompleted++;
                    this.renderMissions();
                    this.updateDisplay();
                    this.showNotification(`Misi√≥n completada: ${mission.name}`, 'achievement');
                    this.checkAchievements();
                }
            }

            initializeAchievements() {
                this.achievements = [
                    { id: 'clicker100', name: 'Clickeador Novato', desc: 'Haz 100 clics', reward: '‚ö°+50', unlocked: false },
                    { id: 'clicker1k', name: 'Clickeador Experto', desc: 'Haz 1,000 clics', reward: 'üíé+100', unlocked: false },
                    { id: 'clicker100k', name: 'Clickeador Maestro', desc: 'Haz 100,000 clics', reward: '‚ôæÔ∏è+1', unlocked: false },
                    { id: 'combo10', name: 'Combo Inicial', desc: 'Alcanza combo x10', reward: 'üî•+50', unlocked: false },
                    { id: 'combo100', name: 'Combo Extremo', desc: 'Alcanza combo x100', reward: 'Nuevo color de click', unlocked: false },
                    { id: 'wealth1m', name: 'Millonario', desc: '1M de riqueza', reward: 'üåå+5', unlocked: false },
                    { id: 'wealth1b', name: 'Billonario Gal√°ctico', desc: '1B de riqueza', reward: '‚öõÔ∏è+10', unlocked: false },
                    { id: 'prestige5', name: 'Renacido', desc: '5 Prestigios', reward: 'Poder de flota x2', unlocked: false },
                    { id: 'dimensional3', name: 'Viajador', desc: '3 Dimensiones', reward: 'üì¶ Bonus permanente', unlocked: false },
                    { id: 'missions10', name: 'Misionero', desc: '10 misiones', reward: 'Auto-completar misiones', unlocked: false }
                ];
                this.renderAchievements();
            }

            renderAchievements() {
                const grid = document.getElementById('achievementsGrid');
                grid.innerHTML = '';
                this.achievements.forEach(achievement => {
                    const card = document.createElement('div');
                    card.className = `achievement-card ${achievement.unlocked ? 'unlocked' : ''}`;
                    card.innerHTML = `
                        <i class="fas fa-trophy achievement-icon" style="${achievement.unlocked ? 'color: #4caf50;' : ''}"></i>
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-desc">${achievement.desc}</div>
                        <div class="achievement-reward">Recompensa: ${achievement.reward}</div>
                    `;
                    grid.appendChild(card);
                });
            }

            checkAchievements() {
                const checks = [
                    { id: 'clicker100', condition: this.stats.totalClicks >= 100 },
                    { id: 'clicker1k', condition: this.stats.totalClicks >= 1000 },
                    { id: 'clicker100k', condition: this.stats.totalClicks >= 100000 },
                    { id: 'combo10', condition: this.stats.bestCombo >= 10 },
                    { id: 'combo100', condition: this.stats.bestCombo >= 100 },
                    { id: 'wealth1m', condition: this.empire.totalWealth >= 1000000 },
                    { id: 'wealth1b', condition: this.empire.totalWealth >= 1000000000 },
                    { id: 'prestige5', condition: this.empire.prestige >= 5 },
                    { id: 'dimensional3', condition: this.empire.dimensions >= 3 },
                    { id: 'missions10', condition: this.stats.missionsCompleted >= 10 }
                ];

                checks.forEach(({ id, condition }) => {
                    const achievement = this.achievements.find(a => a.id === id);
                    if (achievement && !achievement.unlocked && condition) {
                        achievement.unlocked = true;
                        this.stats.achievements.add(id);
                        this.renderAchievements();
                        this.showNotification(`¬°Logro desbloqueado: ${achievement.name}!`, 'achievement');
                    }
                });
            }

            exportSave() {
                const saveData = this.getSaveData();
                const dataStr = JSON.stringify(saveData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `galactic_empire_${this.currentUser}_${Date.now()}.json`;
                link.click();
                this.showNotification('Partida exportada exitosamente', 'success');
            }

            importSave() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const saveData = JSON.parse(event.target.result);
                            this.loadGame(saveData);
                            this.showNotification('Partida importada exitosamente', 'success');
                        } catch (error) {
                            this.showNotification('Error al importar la partida', 'warning');
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            }

            resetGame() {
                if (confirm('¬øEst√°s seguro de que quieres ELIMINAR TODO tu progreso? Esta acci√≥n no se puede deshacer.')) {
                    if (confirm('√öltima advertencia: ¬øRealmente quieres borrar TODO?')) {
                        localStorage.removeItem(`galacticEmpire_${this.currentUser}`);
                        location.reload();
                    }
                }
            }

            updateDisplay() {
                // Resources
                Object.keys(this.resources).forEach(resource => {
                    const element = document.getElementById(resource);
                    if (element) element.textContent = this.formatNumber(this.resources[resource]);
                });

                // Rates
                const rates = {
                    energy: (this.generators.miners * 1 + this.generators.powerPlants * 10) * this.upgrades.globalMultiplier * Math.pow(2, this.empire.dimensions) / 60,
                    minerals: this.generators.quarries * 3 * this.upgrades.globalMultiplier * Math.pow(2, this.empire.dimensions) / 60,
                    crystals: this.generators.crystalFarms * 2 * this.upgrades.globalMultiplier * Math.pow(2, this.empire.dimensions) / 60,
                    plasma: this.generators.plasmaExtractors * 2 * this.upgrades.globalMultiplier * Math.pow(2, this.empire.dimensions) / 60,
                    darkMatter: this.generators.darkMatterCollectors * 0.2 * this.upgrades.globalMultiplier * Math.pow(2, this.empire.dimensions) / 60,
                    quantum: this.generators.quantumComputers * 0.05 * this.upgrades.globalMultiplier * Math.pow(2, this.empire.dimensions) / 60,
                    infinity: this.generators.dimensionalPortals * 0.01 * this.upgrades.globalMultiplier * Math.pow(2, this.empire.dimensions) / 60
                };

                Object.keys(rates).forEach(resource => {
                    const element = document.getElementById(resource + '-rate');
                    if (element) element.textContent = this.formatNumber(rates[resource]) + '/s';
                });

                // Empire stats
                document.getElementById('totalWealth').textContent = this.formatNumber(this.empire.totalWealth);
                document.getElementById('population').textContent = this.formatNumber(this.empire.population);
                document.getElementById('fleetPower').textContent = this.formatNumber(this.empire.fleetPower);
                document.getElementById('research').textContent = this.formatNumber(this.empire.research);
                document.getElementById('prestige').textContent = this.empire.prestige;
                document.getElementById('dimensions').textContent = this.empire.dimensions;

                // Fleet display
                Object.keys(this.fleet).forEach(unit => {
                    const element = document.getElementById(unit + '-count');
                    if (element) element.textContent = this.fleet[unit];
                });

                // Click power and auto-clicker
                const clickValue = Math.floor(this.upgrades.clickPower * this.upgrades.globalMultiplier * (1 + this.upgrades.spaceStation * 0.1) * Math.pow(2, this.empire.dimensions));
                document.getElementById('clickPower').textContent = `+${clickValue}`;
                document.getElementById('autoClickStatus').textContent = this.upgrades.autoClicker > 0 ? `[AUTO ${this.upgrades.autoClicker}/s]` : '';

                // Upgrade costs
                document.getElementById('miner-cost').textContent = Math.floor(10 * Math.pow(1.15, this.generators.miners));
                document.getElementById('quarry-cost').textContent = Math.floor(50 * Math.pow(1.15, this.generators.quarries));
                document.getElementById('crystal-cost').textContent = Math.floor(200 * Math.pow(1.15, this.generators.crystalFarms));
                document.getElementById('power-cost').textContent = Math.floor(500 * Math.pow(1.15, this.generators.powerPlants));
                document.getElementById('plasma-cost').textContent = Math.floor(1000 * Math.pow(1.15, this.generators.plasmaExtractors));
                document.getElementById('darkmatter-cost').textContent = Math.floor(500 * Math.pow(1.15, this.generators.darkMatterCollectors));
                document.getElementById('quantum-cost').textContent = Math.floor(100 * Math.pow(1.15, this.generators.quantumComputers));
                document.getElementById('portal-cost').textContent = Math.floor(50 * Math.pow(1.15, this.generators.dimensionalPortals));
                
                document.getElementById('click-cost').textContent = 100 * this.upgrades.clickPower;
                document.getElementById('multiplier-cost').textContent = 1000 * this.upgrades.globalMultiplier;
                document.getElementById('auto-click-cost').textContent = 5000 * (this.upgrades.autoClicker + 1);
                document.getElementById('combo-cost').textContent = 10000 * this.upgrades.comboSpeed;
                document.getElementById('lab-cost').textContent = Math.floor(5000 * Math.pow(1.15, this.upgrades.laboratory));
                document.getElementById('shipyard-cost').textContent = Math.floor(10000 * Math.pow(1.15, this.upgrades.shipyard));
                document.getElementById('station-cost').textContent = Math.floor(25000 * Math.pow(1.15, this.upgrades.spaceStation));

                // Modal thresholds
                document.getElementById('prestigeThresholdText').textContent = this.formatNumber(this.prestigeThreshold);
                document.getElementById('dimensionalThresholdText').textContent = this.dimensionalThreshold;

                // Stats
                document.getElementById('totalClicksStat').textContent = this.formatNumber(this.stats.totalClicks);
                document.getElementById('bestComboStat').textContent = this.stats.bestCombo;
                document.getElementById('resourcesMinedStat').textContent = this.formatNumber(this.stats.resourcesMined);
                document.getElementById('playTimeStat').textContent = this.formatPlayTime(this.stats.playTime);
                document.getElementById('achievementsStat').textContent = this.stats.achievements.size;
                document.getElementById('achievementsTotal').textContent = this.achievements.length;
                document.getElementById('missionsStat').textContent = this.stats.missionsCompleted;

                this.updateButtonStates();
            }

            updateButtonStates() {
                const upgrades = [
                    { id: 'buy-miner', cost: Math.floor(10 * Math.pow(1.15, this.generators.miners)), resource: 'energy' },
                    { id: 'buy-quarry', cost: Math.floor(50 * Math.pow(1.15, this.generators.quarries)), resource: 'energy' },
                    { id: 'buy-crystal-farm', cost: Math.floor(200 * Math.pow(1.15, this.generators.crystalFarms)), resource: 'energy' },
                    { id: 'buy-power-plant', cost: Math.floor(500 * Math.pow(1.15, this.generators.powerPlants)), resource: 'energy' },
                    { id: 'buy-plasma', cost: Math.floor(1000 * Math.pow(1.15, this.generators.plasmaExtractors)), resource: 'crystals' },
                    { id: 'buy-darkmatter', cost: Math.floor(500 * Math.pow(1.15, this.generators.darkMatterCollectors)), resource: 'plasma' },
                    { id: 'buy-quantum', cost: Math.floor(100 * Math.pow(1.15, this.generators.quantumComputers)), resource: 'darkMatter' },
                    { id: 'buy-portal', cost: Math.floor(50 * Math.pow(1.15, this.generators.dimensionalPortals)), resource: 'quantum' },
                    { id: 'upgrade-click', cost: 100 * this.upgrades.clickPower, resource: 'energy' },
                    { id: 'upgrade-multiplier', cost: 1000 * this.upgrades.globalMultiplier, resource: 'energy' },
                    { id: 'upgrade-auto-click', cost: 5000 * (this.upgrades.autoClicker + 1), resource: 'energy' },
                    { id: 'upgrade-combo', cost: 10000 * this.upgrades.comboSpeed, resource: 'energy' },
                    { id: 'buy-laboratory', cost: Math.floor(5000 * Math.pow(1.15, this.upgrades.laboratory)), resource: 'minerals' },
                    { id: 'buy-shipyard', cost: Math.floor(10000 * Math.pow(1.15, this.upgrades.shipyard)), resource: 'crystals' },
                    { id: 'buy-station', cost: Math.floor(25000 * Math.pow(1.15, this.upgrades.spaceStation)), resource: 'plasma' }
                ];

                upgrades.forEach(({ id, cost, resource }) => {
                    const button = document.getElementById(id);
                    if (button) {
                        const canAfford = this.resources[resource] >= cost;
                        button.disabled = !canAfford;
                        button.style.opacity = canAfford ? '1' : '0.5';
                    }
                });
            }

            formatNumber(num) {
                if (num >= 1e18) return (num / 1e18).toFixed(2) + 'S';
                if (num >= 1e15) return (num / 1e15).toFixed(2) + 'Q';
                if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
                if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
                if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
                if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
                return Math.floor(num).toString();
            }

            formatPlayTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);
                return `${hours}h ${minutes}m ${secs}s`;
            }

            startGameLoop() {
                this.gameLoopInterval = setInterval(() => {
                    const now = Date.now();
                    const deltaTime = (now - this.lastUpdate) / 1000;
                    this.lastUpdate = now;
                    this.stats.playTime += deltaTime;
                    this.generateResources();
                    this.checkAchievements();
                    this.updateDisplay();
                    this.saveGame();
                }, 1000 / 60);
            }

            getSaveData() {
                return {
                    resources: this.resources,
                    generators: this.generators,
                    upgrades: this.upgrades,
                    fleet: this.fleet,
                    empire: this.empire,
                    stats: {
                        totalClicks: this.stats.totalClicks,
                        bestCombo: this.stats.bestCombo,
                        resourcesMined: this.stats.resourcesMined,
                        playTime: this.stats.playTime,
                        achievements: Array.from(this.stats.achievements),
                        missionsCompleted: this.stats.missionsCompleted
                    },
                    missions: this.missions,
                    achievements: this.achievements.map(a => ({ id: a.id, unlocked: a.unlocked })),
                    lastSave: Date.now()
                };
            }

            saveGame() {
                if (!this.currentUser) return;
                const saveData = this.getSaveData();
                localStorage.setItem(`galacticEmpire_${this.currentUser}`, JSON.stringify(saveData));
            }

            loadGame(saveData = null) {
                if (!this.currentUser) return;
                
                const data = saveData || JSON.parse(localStorage.getItem(`galacticEmpire_${this.currentUser}`) || '{}');
                
                Object.assign(this.resources, data.resources || {});
                Object.assign(this.generators, data.generators || {});
                Object.assign(this.upgrades, data.upgrades || {});
                Object.assign(this.fleet, data.fleet || {});
                Object.assign(this.empire, data.empire || {});
                
                if (data.stats) {
                    Object.assign(this.stats, {
                        totalClicks: data.stats.totalClicks || 0,
                        bestCombo: data.stats.bestCombo || 0,
                        resourcesMined: data.stats.resourcesMined || 0,
                        playTime: data.stats.playTime || 0,
                        achievements: new Set(data.stats.achievements || []),
                        missionsCompleted: data.stats.missionsCompleted || 0
                    });
                }

                if (data.missions) {
                    this.missions.forEach(mission => {
                        const savedMission = data.missions.find(m => m.id === mission.id);
                        if (savedMission) Object.assign(mission, savedMission);
                    });
                    this.renderMissions();
                }

                if (data.achievements) {
                    data.achievements.forEach(({ id, unlocked }) => {
                        const achievement = this.achievements.find(a => a.id === id);
                        if (achievement) achievement.unlocked = unlocked;
                    });
                    this.renderAchievements();
                }

                this.updateFleetPower();
                this.updatePlayerLevel();
                this.checkMissionProgress('click', 0);
                this.updateAutoClicker();
            }

            hideLoadingScreen() {
                setTimeout(() => {
                    document.getElementById('loadingScreen').classList.add('hidden');
                    this.isLoaded = true;
                }, 2000);
            }

            showNotification(text, type = 'success') {
                const container = document.getElementById('notificationContainer');
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = text;
                container.appendChild(notification);
                setTimeout(() => notification.classList.add('show'), 100);
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 500);
                }, 3000);
            }
        }

        // Initialize game
        window.addEventListener('load', () => {
            new GalacticEmpireInfinity();
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) event.preventDefault();
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
